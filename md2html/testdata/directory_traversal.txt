# Test directory traversal and markdown finding

# Test with different depth settings
md2html -depth 2 -v -http :9032 &
sleep 1s

# Check that shallow files are found
exec curl -s http://localhost:9032/
stdout 'level1.md'

# Test deeper depth
md2html -depth 4 -v -http :9033 &
sleep 1s

# Check that deeper files are found
exec curl -s http://localhost:9033/
stdout 'level3.md'

# Test static generation with file finding
md2html -html output -v
exists output/level1.html
exists output/subdir/level2.html
exists output/subdir/deep/level3.html

# Test finding both .md and .markdown files
exec curl -s http://localhost:9033/
stdout 'document.markdown'

# Clean up
rm -rf output

# Clean up background process

-- level1.md --
# Level 1 Document

This is at the root level.

-- subdir/level2.md --
# Level 2 Document

This is in a subdirectory.

-- subdir/deep/level3.md --
# Level 3 Document

This is nested deeper.

-- document.markdown --
# Markdown Extension Document

This uses .markdown extension instead of .md.