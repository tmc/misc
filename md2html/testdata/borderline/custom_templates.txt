# Test custom template loading and rendering

# Start server with custom templates directory
md2html -input doc.md -templates my-templates -http :9004 &
sleep 1s

# Verify custom template is being used
exec curl -s http://localhost:9004/
stdout 'Custom Template Loaded'

# Test with non-existent template directory (should fall back to embedded)
md2html -input doc.md -templates nonexistent-dir -http :9005 &
sleep 1s

# Should still work with embedded templates
exec curl -s http://localhost:9005/
stdout '<!DOCTYPE html>'

# Clean up background process
wait

-- doc.md --
# Test Document

This document tests custom template functionality.

-- my-templates/base.html --
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Custom Template Loaded</title>
</head>
<body>
    <h1>Custom Template Loaded</h1>
    {{.Content}}
</body>
</html>

-- my-templates/page.html --
{{template "base.html" .}}

-- my-templates/docs.html --
{{template "base.html" .}}