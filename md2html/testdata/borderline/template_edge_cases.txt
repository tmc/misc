# Test template loading and rendering edge cases

# Test with malformed template directory structure
md2html -templates bad-templates -http :9039 &
sleep 1s

# Should fall back to embedded templates
curl -s http://localhost:9039/
stdout '<!DOCTYPE html>'

# Test with data JSON in templates
md2html -data-json data.json -templates data-templates -http :9040 &
sleep 1s

# Verify JSON data is accessible in template
curl -s http://localhost:9040/
stdout 'Test Value'

# Test template with various names
md2html -templates named-templates -http :9041 &
sleep 1s

curl -s http://localhost:9041/
stdout 'Custom Layout Template'

# Clean up background process
wait

-- doc.md --
# Template Test Document

Testing template system.

-- data.json --
{
  "testKey": "Test Value",
  "nested": {
    "value": "Nested Value"
  }
}

-- bad-templates/invalid.html --
{{invalid template syntax without proper closing

-- data-templates/base.html --
<!DOCTYPE html>
<html>
<head><title>{{.Title}}</title></head>
<body>
{{if .Data}}
<div>JSON Data: {{.Data.testKey}}</div>
{{end}}
{{.Content}}
</body>
</html>

-- named-templates/layout.html --
<!DOCTYPE html>
<html>
<head><title>Custom Layout Template</title></head>
<body>{{.Content}}</body>
</html>

-- named-templates/docs.html --
{{template "layout.html" .}}

-- named-templates/page.html --
{{template "layout.html" .}}