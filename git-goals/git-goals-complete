#!/bin/bash
set -euo pipefail

if [ $# -lt 1 ]; then
    echo "Usage: git goals complete <goal_id> [rationale]"
    exit 1
fi

id="$1"
rationale="${2:-}"

# Check if .git-goals file exists
if [ ! -f .git-goals ]; then
    echo "Error: No goals found. Use 'git goals create' to add a new goal."
    exit 1
fi

# Update the goal status to completed
sed -i "s/^#$id |[^|]*|/#$id | COMPLETED |/" .git-goals

# Check if the update was successful
if grep -q "^#$id | COMPLETED |" .git-goals; then
    echo "Goal $id marked as complete"
    if [ -n "$rationale" ]; then
        echo "Rationale: $rationale"
        # TODO: Add rationale to the goal entry
    fi
else
    echo "Error: Failed to complete goal $id. Make sure the ID exists."
    exit 1
fi

