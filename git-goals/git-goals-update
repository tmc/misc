#!/bin/bash
# git-goals-update - Updates an existing goal
set -euo pipefail

if [ $# -lt 2 ]; then
    echo "Usage: git goals update <goal_id> <new_description>"
    exit 1
fi

goal_id="$1"
shift
new_description="$*"

# Find the commit hash for the given goal ID
commit_hash=$(git notes --ref=goals list | grep "$goal_id" | awk "{print \$1}")

if [ -z "$commit_hash" ]; then
    echo "Error: Goal with ID $goal_id not found."
    exit 1
fi

# Get the current goal data
current_data=$(git notes --ref=goals show "$commit_hash")

# Update the description
updated_data=$(echo "$current_data" | sed "s/^description:.*$/description: $new_description/")

# Update the git note
echo "$updated_data" | git notes --ref=goals add -f -F - "$commit_hash"

echo "Updated goal $goal_id: $new_description"

