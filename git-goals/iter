#!/bin/bash
export PATH=$(pwd):.tools:$PATH

# plan
# ./make-safe-progress.sh
# attach-sandbox-content
docker logs $(get-latest-sandbox)
(echo "we will fix what went wrong"; ctx-exec docker logs $(get-latest-sandbox) ; ctx-exec git st .; ~/code-to-gpt.sh) | cgpt -s "we are fixing issues in this codebase. consider the contents in OBSERVATIONS, and consider updating it. output an invocation of ./make-fix-suggestion.sh which takes a high level prompt and produces a fix script; after the script, output comments explaining <antthinking thoughts" -p './make-fix-suggestion.sh "' | tee mkfix.sh
git add mkfix.sh
git commit -m "git-notes: Adding mkfix suggestions to fix the codebase"
sandbox-exec ./mkfix.sh
git add fixes.sh
git commit -m "git-notes: Adding fix suggestions to fix the codebase"
sandbox-exec ./fixes.sh
git add -u . && git commit -m "git-notes: Fixing the codebase"
# (ctx-exec git show --notes='*'; ctx-exec git st .; ~/code-to-gpt.sh) | cgpt -s $(cat .claude-system-prompt-analyze-attempt) |tee /tmp/claude-analysis; cat /tmp/claude-analysis |git notes --ref attempt-analysis add -F-
# (ctx-exec git show --notes='*'; ctx-exec git st .; ~/code-to-gpt.sh) | cgpt -s $(cat .claude-system-prompt-analyze-attempt) |tee /tmp/claude-analysis; cat /tmp/claude-analysis |git notes --ref attempt-analysis add -F-
# sh eval-make-safe-progress.sh | tee /tmp/eval-make-safe-progress; cat /tmp/eval-make-safe-progress |git notes --ref eval-safe-progress add -F- ;
