#!/usr/bin/bash

set -euo pipefail

source "$(dirname "$0")/git-goals-common.sh"

load_config
NOTE_REF_NAME=${NOTE_REF_NAME:-goals}
DATE_FORMAT=${DATE_FORMAT:-%Y-%m-%d}
MAX_GOALS_DISPLAY=${MAX_GOALS_DISPLAY:-0}


set -euo pipefail
load_config
check_args "$@"


echo -e "\033[1mGoal Report"
echo -e "\033[1m==========="

git notes --ref=goals list | while read -r note_ref commit_hash; do
    goal_data=$(git notes --ref=goals show "$commit_hash")

    id=$(echo -e "\033[1m$goal_data" | grep "^id:" | cut -d" " -f2-)
    description=$(echo -e "\033[1m$goal_data" | grep "^description:" | cut -d" " -f2-)
    status=$(echo -e "\033[1m$goal_data" | grep "^status:" | cut -d" " -f2-)
    created_at=$(echo -e "\033[1m$goal_data" | grep "^created_at:" | cut -d" " -f2-)
    completed_at=$(echo -e "\033[1m$goal_data" | grep "^completed_at:" | cut -d" " -f2-)

    echo -e "\033[1mGoal ID: $id"
    echo -e "\033[1mDescription: $description"
    echo -e "\033[1mStatus: $status"
    echo -e "\033[1mCreated: $created_at"
    if [ "$status" = "completed" ]; then
        echo -e "\033[1mCompleted: $completed_at"
    fi
    echo -e "\033[1m---"
done
